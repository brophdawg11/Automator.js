(function(d,e){function a(f){return f&&typeof f.done==="function"&&typeof f.fail==="function"&&typeof f.always==="function"&&typeof f.then==="function"}function b(g,f){if(a(f)){f.always(g)}else{g()}}function c(s){var q,k,r,m,o,p,n,l;s=typeof s==="object"?s:{};for(q in c.defaults){if(typeof s[q]==="undefined"||s[q===null]){s[q]=c.defaults[q]}}function g(){if(s.debug){var t=Array.prototype.slice.call(arguments);t.unshift("Automator.js: ");console.log.apply(console,t)}}function i(){k=[];r=0;m=1;o=0;n=new s.Deferred();l=false}function j(u,t){if(typeof t==="number"&&t>0){g("Sleeping for "+t+"ms");return setTimeout.bind(null,u,t)}return u}function h(){var t,y,w,v,z,u,x;if(l){g("was killed by user, exiting.");return}if(r>=k.length){g("iteration "+o+" completed");if(typeof p==="function"){g("Executing iteration callback");z=p(o)}if(++o>=m){g("Done with iterations");b(n.resolve,z);return}g("Automator iteration "+o+" ready to start");r=0;x=j(h,s.iterationDelay);b(x,z);return}y=k[r++];t=k[r];if(y==null){g("Skipping null action");h();return}g("Handling action: "+y);u=s.stepDelay;w=(typeof y);if(w==="number"){u=0;v=s.doNumber}else{if(w==="string"){v=s.doString}else{if(w==="function"){v=s.doFunction}else{throw"Unsupported type!"}}}if(typeof t==="number"||t==null){u=0}x=j(h,u);z=v(y);b(x,z)}function f(u){var v=[],z,y,w,x=-1,t=u.length;while(++x<t){z=u[x];if(typeof z==="string"){y=z.match(/(.*)+x(\d+)$/);if(y&&y.length===3){z=y[1];w=parseInt(y[2],10);while(w-->0){v.push(z)}continue}}v.push(z)}return v}this.automate=function(u,v,t){v=(typeof v==="number")?v:1;i();k=f(u);m=v;p=t;h();return n.promise()};this.kill=function(){l=true}}c.keyCodeMap={"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left:37,up:38,right:39,down:40,enter:13,tab:9,ctrl:17,esc:27,space:32};c.doNumber=function(g){var f=new $.Deferred();setTimeout(f.resolve,g);return f.promise()};c.doFunction=function(f){return f()};c.doString=function(h){var g=c.keyCodeMap[h],f;if(typeof g!=="number"){return}f=document.createEventObject?document.createEventObject():document.createEvent("Events");if(typeof f.initEvent==="function"){f.initEvent("keydown",true,true)}f.keyCode=g;f.which=g;if(typeof document.dispatchEvent==="function"){document.dispatchEvent(f)}else{document.fireEvent("onkeydown",f)}};c.doObject=function(f){};c.defaults={debug:false,stepDelay:0,iterationDelay:0,Deferred:$.Deferred,doNumber:c.doNumber,doFunction:c.doFunction,doString:c.doString,doObject:c.doObject};d.Automator=c}(this));