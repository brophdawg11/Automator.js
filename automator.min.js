(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Automator=b()}}}(this,function(){function a(d){return d&&typeof d.done==="function"&&typeof d.fail==="function"&&typeof d.always==="function"&&typeof d.then==="function"}function b(e,d){if(a(d)){d.always(e)}else{e(d)}}function c(q){var o,i,p,k,m,n,l,j;q=typeof q==="object"?q:{};for(o in c.defaults){if(typeof q[o]==="undefined"||q[o===null]){q[o]=c.defaults[o]}}function e(){if(q.debug){var r=Array.prototype.slice.call(arguments);r.unshift("Automator.js: ");console.log.apply(console,r)}}function g(){i=[];p=0;k=1;m=0;l=new q.Deferred();j=false}function h(s,r){if(typeof r==="number"&&r>0){e("Sleeping for "+r+"ms");return setTimeout.bind(null,s,r)}return s}function f(w){var r,x,u,t,y,s,v;if(j){e("was killed by user, exiting.");return}if(p>=i.length){e("iteration "+m+" completed");if(typeof n==="function"){e("Executing iteration callback");y=n(m)}if(++m>=k){e("Done with iterations");b(l.resolve,y);return}e("Automator iteration "+m+" ready to start");p=0;v=h(f,q.iterationDelay);b(v,y);return}x=i[p++];r=i[p];if(x==null){e("Skipping null action");f();return}e("Handling action: "+x);u=(typeof x);if(u==="number"){t=q.doNumber}else{if(u==="string"){t=q.doString}else{if(u==="function"){t=q.doFunction}else{throw"Unsupported type!"}}}if(u==="number"||typeof r==="number"||r==null){s=0}else{s=q.stepDelay}v=h(f,s);y=t.call(null,x,w);b(v,y)}function d(s){var t=[],x,w,u,v=-1,r=s.length;while(++v<r){x=s[v];if(typeof x==="string"){w=x.match(/(.*)+x(\d+)$/);if(w&&w.length===3){x=w[1];u=parseInt(w[2],10);while(u-->0){t.push(x)}continue}}t.push(x)}return t}this.automate=function(s,t,r){t=(typeof t==="number")?t:1;g();i=d(s);k=t;n=r;f();return l.promise()};this.kill=function(){j=true}}c.keyCodeMap={"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left:37,up:38,right:39,down:40,enter:13,tab:9,ctrl:17,esc:27,space:32};c.doNumber=function(f,e){var d=new $.Deferred();setTimeout(d.resolve.bind(d,e),f);return d.promise()};c.doFunction=function(d,e){return d.call(null,e)};c.simulateKeyEvent=function(d,f){var e=document.createEventObject?document.createEventObject():document.createEvent("Events");if(typeof e.initEvent==="function"){e.initEvent("keydown",true,true)}e.keyCode=f;e.which=f;if(typeof document.dispatchEvent==="function"){document.dispatchEvent(e)}else{document.fireEvent("onkeydown",e)}};c.doString=function(e,f){var d=c.keyCodeMap[e];if(typeof d!=="number"){return}return c.simulateKeyEvent("keydown",d)};c.doObject=function(d,e){};c.defaults={debug:false,stepDelay:0,iterationDelay:0,Deferred:$.Deferred,doNumber:c.doNumber,doFunction:c.doFunction,doString:c.doString,doObject:c.doObject};return c}));