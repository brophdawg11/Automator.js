<!DOCTYPE html>

<html>
<head>
  <title>automator.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>automator.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* ========================================================================
 * Automator.js v0.1.1
 * A minimal JavaScript library for automating practically anything
 * in Javascript.
 *
 * Copyright (c) 2013 Matt Brophy (brophy.org)
 * https://github.com/brophdawg11/Automator.js
 *
 * Author: Matt Brophy
 * Website: http://www.brophy.org/
 *
 * Released under the MIT license
 * https://github.com/brophdawg11/Automator.js/blob/master/LICENSE
 * ------------------------------------------------------------------------ */</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(root, factory)</span> {</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> define === <span class="hljs-string">'function'</span> &amp;&amp; define.amd) {</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>AMD. Register as an anonymous module.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        define(factory);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> exports === <span class="hljs-string">'object'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Node.js</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        module.exports = factory();
    } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Browser globals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        root.Automator = factory();
    }
}(<span class="hljs-keyword">this</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Utility function to see if an object is promise-like</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPromise</span><span class="hljs-params">(p)</span> {</span>
        <span class="hljs-keyword">return</span> p &amp;&amp;
               <span class="hljs-keyword">typeof</span> p.done === <span class="hljs-string">'function'</span> &amp;&amp;
               <span class="hljs-keyword">typeof</span> p.fail === <span class="hljs-string">'function'</span> &amp;&amp;
               <span class="hljs-keyword">typeof</span> p.always === <span class="hljs-string">'function'</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Utility function to check if an object is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span><span class="hljs-params">(a)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-string">'isArray'</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">Array</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.isArray(a);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(a) === <span class="hljs-string">'[object Array]'</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Automator</span><span class="hljs-params">(options)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="initialization">Initialization</h2>

            </div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">var</span> key,</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Array of actions to automate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            actions,</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>interim actions returned from an executed function, executed
prior to the next step in ‘actions’.  Maintained as a LIFO
stack of arrays of actions.  That way steps during interim
actions can return more interim actions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            interimActions,</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Current action index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            actionIdx,</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Number of iterations to run of the actions array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            numIterations,</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Current iteration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            iterationIdx,</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Callback function for each iteration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            iterationCb,</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Final deferred</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            finalDfd,</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Have we been killed by the user</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            killed;</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Initialize options with default values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        options = <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'object'</span> ? options : {};
        <span class="hljs-keyword">for</span> (key <span class="hljs-keyword">in</span> Automator.defaults) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options[key] === <span class="hljs-string">'undefined'</span> || options[key === <span class="hljs-literal">null</span>]) {
                options[key] = Automator.defaults[key];
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="private-functions">Private functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Logging function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">debug</span><span class="hljs-params">()</span> {</span>
            <span class="hljs-keyword">if</span> (options.debug) {
                <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                args.unshift(<span class="hljs-string">"Automator.js: "</span>);
                console.log.apply(console, args);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Reset all internal state variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetState</span><span class="hljs-params">()</span> {</span>
            actions = [];
            interimActions = [];
            actionIdx = <span class="hljs-number">0</span>;
            numIterations = <span class="hljs-number">1</span>;
            iterationIdx = <span class="hljs-number">0</span>;
            finalDfd = <span class="hljs-keyword">new</span> options.Deferred();
            killed = <span class="hljs-literal">false</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Return a function to be run after the specified delay</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDelayedFunction</span><span class="hljs-params">(func, delay)</span> {</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> delay === <span class="hljs-string">'number'</span> &amp;&amp; delay &gt; <span class="hljs-number">0</span>) {
                debug(<span class="hljs-string">'Sleeping for '</span> + delay + <span class="hljs-string">'ms'</span>);
                <span class="hljs-keyword">return</span> setTimeout.bind(<span class="hljs-literal">null</span>, func, delay);
            }
            <span class="hljs-keyword">return</span> func;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Utility function to run a specified callback, potentially after a
promise is resolved.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">runAfterPromise</span><span class="hljs-params">(func, maybePromise)</span> {</span>
            <span class="hljs-keyword">if</span> (isPromise(maybePromise)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Defer step until the promise is resolved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                debug(<span class="hljs-string">"Deferring next step until the promise is resolved"</span>);
                maybePromise.always(func);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isArray(maybePromise)) {
                <span class="hljs-keyword">if</span> (maybePromise.length &gt; <span class="hljs-number">0</span>) {
                    debug(<span class="hljs-string">"Received back an array of interim actions, "</span> +
                          <span class="hljs-string">"running them now: "</span>, maybePromise);
                    interimActions.unshift(maybePromise);
                }
                func();
            } <span class="hljs-keyword">else</span> {
                debug(<span class="hljs-string">"Passing value through to next step: "</span>, maybePromise);
                func(maybePromise);
            }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Execute a single step</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span><span class="hljs-params">(passThrough)</span> {</span>
            <span class="hljs-keyword">var</span> nextAction, action, type, handler, retVal, delay, deferredStep;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Did the user kill us?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (killed) {
                debug(<span class="hljs-string">"was killed by user, exiting."</span>);
                <span class="hljs-keyword">return</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Are we done with our actions?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (actionIdx &gt;= actions.length) {

                debug(<span class="hljs-string">"iteration "</span> + iterationIdx + <span class="hljs-string">" completed"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Did we have an iteration callback to run?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> iterationCb === <span class="hljs-string">'function'</span>) {
                    debug(<span class="hljs-string">"Executing iteration callback"</span>);
                    retVal = iterationCb(iterationIdx);
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Are we done?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (++iterationIdx &gt;= numIterations) {
                    debug(<span class="hljs-string">"Done with iterations"</span>);
                    runAfterPromise(finalDfd.resolve, retVal);
                    <span class="hljs-keyword">return</span>;
                }

                debug(<span class="hljs-string">"Automator iteration "</span> + iterationIdx + <span class="hljs-string">" ready to start"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Start back at the beginning</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                actionIdx = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Prep our next iteration after a delay, if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                deferredStep = getDelayedFunction(step, options.iterationDelay);</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Run the next step after a potential promise is resolved</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                runAfterPromise(deferredStep, retVal);

                <span class="hljs-keyword">return</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Get the next action</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (interimActions.length &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Get from the top array in the stack</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                action = interimActions[<span class="hljs-number">0</span>].shift();</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>If we just removed the last interim action from this top
entry in the stack, pop off the empty array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span> (interimActions[<span class="hljs-number">0</span>].length === <span class="hljs-number">0</span>) {
                    interimActions.shift();
                }
            } <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Increment after grab</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                action = actions[actionIdx++];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Peek ahead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (interimActions.length &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>We still have interims</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                nextAction = interimActions[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>];
            } <span class="hljs-keyword">else</span> {
                nextAction = actions[actionIdx];
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Short circuit on bad actions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (action == <span class="hljs-literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Skip it and move on</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                debug(<span class="hljs-string">"Skipping null action"</span>);
                step();
                <span class="hljs-keyword">return</span>;
            }

            debug(<span class="hljs-string">'Handling action: '</span> + action);</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Pass off to the apropriate handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            type = (<span class="hljs-keyword">typeof</span> action);
            <span class="hljs-keyword">if</span>      (type === <span class="hljs-string">'number'</span>)   {
                handler = options.doNumber;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'string'</span>) {
                handler = options.doString;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'function'</span>) {
                handler = options.doFunction;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-string">"Unsupported type!"</span>;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Don’t front or back pad numbers with a delay,
and don’t delay at the end of the array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'number'</span> ||
                <span class="hljs-keyword">typeof</span> nextAction === <span class="hljs-string">'number'</span> ||
                nextAction == <span class="hljs-literal">null</span>) {
                delay = <span class="hljs-number">0</span>;
            } <span class="hljs-keyword">else</span> {
                delay = options.stepDelay;
            }</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Prep our next step after a delay, if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            deferredStep = getDelayedFunction(step, delay);</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Run the handler, then move onto the next step, potentially
after a returned promise resolution</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            retVal = handler.call(<span class="hljs-literal">null</span>, action, passThrough);
            runAfterPromise(deferredStep, retVal);
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Internal function to expand repeated string functionality</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">expandActions</span><span class="hljs-params">(arr)</span> {</span>
            <span class="hljs-keyword">var</span> expanded = [],
                action,
                matches,
                num,
                i = -<span class="hljs-number">1</span>,
                len = arr.length;

            <span class="hljs-keyword">while</span> (++i &lt; len) {
                action = arr[i];
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> action === <span class="hljs-string">'string'</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Look for trailing …x<num></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                    matches = action.match(<span class="hljs-regexp">/(.*)+x(\d+)$/</span>);
                    <span class="hljs-keyword">if</span> (matches &amp;&amp; matches.length === <span class="hljs-number">3</span>) {
                        action = matches[<span class="hljs-number">1</span>];
                        num = <span class="hljs-built_in">parseInt</span>(matches[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Add n duplicates of this string and continue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                        <span class="hljs-keyword">while</span> (num-- &gt; <span class="hljs-number">0</span>) { expanded.push(action); }
                        <span class="hljs-keyword">continue</span>;
                    }
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Copy non-x<num> strings and any non strings straight over</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                expanded.push(action);
            }

            <span class="hljs-keyword">return</span> expanded;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h2 id="public-functions">Public functions</h2>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">this</span>.automate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(arr, num, cb)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>TODO: Validate input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            num = (<span class="hljs-keyword">typeof</span> num === <span class="hljs-string">'number'</span>) ? num : <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Wipe the slate clean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            resetState();</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Create an expanded array of actions</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            actions = expandActions(arr);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>Store off the number of iterations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            numIterations = num;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Store off the iteration callback function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            iterationCb = cb;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>Go!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            step();

            <span class="hljs-keyword">return</span> finalDfd.promise();
        };</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Kill the automator</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">this</span>.kill = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
            killed = <span class="hljs-literal">true</span>;
        };

    }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>Supported string -&gt; keyCode map</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.keyCodeMap = {
        <span class="hljs-string">'0'</span>: <span class="hljs-number">48</span>,
        <span class="hljs-string">'1'</span>: <span class="hljs-number">49</span>,
        <span class="hljs-string">'2'</span>: <span class="hljs-number">50</span>,
        <span class="hljs-string">'3'</span>: <span class="hljs-number">51</span>,
        <span class="hljs-string">'4'</span>: <span class="hljs-number">52</span>,
        <span class="hljs-string">'5'</span>: <span class="hljs-number">53</span>,
        <span class="hljs-string">'6'</span>: <span class="hljs-number">54</span>,
        <span class="hljs-string">'7'</span>: <span class="hljs-number">55</span>,
        <span class="hljs-string">'8'</span>: <span class="hljs-number">56</span>,
        <span class="hljs-string">'9'</span>: <span class="hljs-number">57</span>,
        <span class="hljs-string">'a'</span>: <span class="hljs-number">65</span>,
        <span class="hljs-string">'b'</span>: <span class="hljs-number">66</span>,
        <span class="hljs-string">'c'</span>: <span class="hljs-number">67</span>,
        <span class="hljs-string">'d'</span>: <span class="hljs-number">68</span>,
        <span class="hljs-string">'e'</span>: <span class="hljs-number">69</span>,
        <span class="hljs-string">'f'</span>: <span class="hljs-number">70</span>,
        <span class="hljs-string">'g'</span>: <span class="hljs-number">71</span>,
        <span class="hljs-string">'h'</span>: <span class="hljs-number">72</span>,
        <span class="hljs-string">'i'</span>: <span class="hljs-number">73</span>,
        <span class="hljs-string">'j'</span>: <span class="hljs-number">74</span>,
        <span class="hljs-string">'k'</span>: <span class="hljs-number">75</span>,
        <span class="hljs-string">'l'</span>: <span class="hljs-number">76</span>,
        <span class="hljs-string">'m'</span>: <span class="hljs-number">77</span>,
        <span class="hljs-string">'n'</span>: <span class="hljs-number">78</span>,
        <span class="hljs-string">'o'</span>: <span class="hljs-number">79</span>,
        <span class="hljs-string">'p'</span>: <span class="hljs-number">80</span>,
        <span class="hljs-string">'q'</span>: <span class="hljs-number">81</span>,
        <span class="hljs-string">'r'</span>: <span class="hljs-number">82</span>,
        <span class="hljs-string">'s'</span>: <span class="hljs-number">83</span>,
        <span class="hljs-string">'t'</span>: <span class="hljs-number">84</span>,
        <span class="hljs-string">'u'</span>: <span class="hljs-number">85</span>,
        <span class="hljs-string">'v'</span>: <span class="hljs-number">86</span>,
        <span class="hljs-string">'w'</span>: <span class="hljs-number">87</span>,
        <span class="hljs-string">'x'</span>: <span class="hljs-number">88</span>,
        <span class="hljs-string">'y'</span>: <span class="hljs-number">89</span>,
        <span class="hljs-string">'z'</span>: <span class="hljs-number">90</span>,
        <span class="hljs-string">'left'</span>: <span class="hljs-number">37</span>,
        <span class="hljs-string">'up'</span>: <span class="hljs-number">38</span>,
        <span class="hljs-string">'right'</span>: <span class="hljs-number">39</span>,
        <span class="hljs-string">'down'</span>: <span class="hljs-number">40</span>,
        <span class="hljs-string">'enter'</span>: <span class="hljs-number">13</span>,
        <span class="hljs-string">'tab'</span>: <span class="hljs-number">9</span>,
        <span class="hljs-string">'ctrl'</span>: <span class="hljs-number">17</span>,
        <span class="hljs-string">'esc'</span>: <span class="hljs-number">27</span>,
        <span class="hljs-string">'space'</span>: <span class="hljs-number">32</span>
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>Default handling of numbers - sleep for specified milliseconds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.doNumber = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(n, passThrough)</span> {</span>
        <span class="hljs-keyword">var</span> dfd = <span class="hljs-keyword">new</span> Automator.MiniDeferred();
        setTimeout(dfd.resolve.bind(dfd, passThrough), n);
        <span class="hljs-keyword">return</span> dfd.promise();
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Default handling of functions - passthrough execution</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.doFunction = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(func, passThrough)</span> {</span>
        <span class="hljs-keyword">return</span> func.call(<span class="hljs-literal">null</span>, passThrough);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Utility function for simulating a key event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.simulateKeyEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(type, keyCode)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>From <a href="http://stackoverflow.com/questions/596481/simulate-javascript-key-events">http://stackoverflow.com/questions/596481/simulate-javascript-key-events</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> eventObj = document.createEventObject ?
                       document.createEventObject() :
                       document.createEvent(<span class="hljs-string">"Events"</span>);


        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> eventObj.initEvent === <span class="hljs-string">'function'</span>) {
            eventObj.initEvent(<span class="hljs-string">"keydown"</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
        }

        eventObj.keyCode = keyCode;
        eventObj.which = keyCode;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> document.dispatchEvent === <span class="hljs-string">'function'</span>) {
            document.dispatchEvent(eventObj);
        } <span class="hljs-keyword">else</span> {
            document.fireEvent(<span class="hljs-string">"onkeydown"</span>, eventObj);
        }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Default handling of strings - simulate keypress of the specified key</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.doString = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(str, passThrough)</span> {</span>
        <span class="hljs-keyword">var</span> keyCode = Automator.keyCodeMap[str];

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> keyCode !== <span class="hljs-string">'number'</span>) { <span class="hljs-keyword">return</span>; }

        <span class="hljs-keyword">return</span> Automator.simulateKeyEvent(<span class="hljs-string">"keydown"</span>, keyCode);
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>No default handling of objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.doObject = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(obj, passThrough)</span> {</span>};

    Automator.MiniDeferred = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">MiniDeferred</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">var</span> callbacks = [],
          currentState = <span class="hljs-number">0</span>,
          currentArgs;

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">go</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">var</span> cb;
        <span class="hljs-keyword">while</span> (callbacks.length &gt; <span class="hljs-number">0</span>) {
          cb = callbacks.shift();
          <span class="hljs-keyword">if</span> (cb.state === currentState) {
            cb.func.apply(<span class="hljs-keyword">this</span>, currentArgs);
          }
        }
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addCallback</span><span class="hljs-params">(type, async, func)</span> {</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> func === <span class="hljs-string">'function'</span>) {
          <span class="hljs-keyword">var</span> cb = { state: type, async: async, func: func };
          callbacks.push(cb);
          <span class="hljs-keyword">if</span> (currentState !== <span class="hljs-number">0</span>) { go(); }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeState</span><span class="hljs-params">(s)</span> {</span>
        <span class="hljs-keyword">if</span> (currentState !== <span class="hljs-number">0</span>) { <span class="hljs-keyword">return</span>; }
        currentState = s;
        currentArgs = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
        go();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      }

      <span class="hljs-keyword">this</span>.resolve = changeState.bind(<span class="hljs-keyword">this</span>, <span class="hljs-number">1</span>);
      <span class="hljs-keyword">this</span>.reject = changeState.bind(<span class="hljs-keyword">this</span>, <span class="hljs-number">2</span>);

      <span class="hljs-keyword">this</span>.promise = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
        <span class="hljs-keyword">return</span> {
          done: <span class="hljs-keyword">this</span>.done.bind(<span class="hljs-keyword">this</span>),
          fail: <span class="hljs-keyword">this</span>.fail.bind(<span class="hljs-keyword">this</span>),
          always: <span class="hljs-keyword">this</span>.always.bind(<span class="hljs-keyword">this</span>)
        };
      };

      <span class="hljs-keyword">this</span>.done = addCallback.bind(<span class="hljs-keyword">this</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">false</span>);
      <span class="hljs-keyword">this</span>.fail = addCallback.bind(<span class="hljs-keyword">this</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">false</span>);

      <span class="hljs-keyword">this</span>.always = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(func)</span> {</span>
        <span class="hljs-keyword">this</span>.done.call(<span class="hljs-keyword">this</span>, func);
        <span class="hljs-keyword">this</span>.fail.call(<span class="hljs-keyword">this</span>, func);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
      };

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Default options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Automator.defaults = {
        debug: <span class="hljs-literal">false</span>,
        stepDelay: <span class="hljs-number">0</span>,
        iterationDelay: <span class="hljs-number">0</span>,
        Deferred: Automator.MiniDeferred,
        doNumber: Automator.doNumber,
        doFunction: Automator.doFunction,
        doString: Automator.doString,
        doObject: Automator.doObject
    };

    <span class="hljs-keyword">return</span> Automator;

}));</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
