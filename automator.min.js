(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"){module.exports=b()}else{a.Automator=b()}}}(this,function(){function b(d){return d&&typeof d.done==="function"&&typeof d.fail==="function"&&typeof d.always==="function"&&typeof d.then==="function"}function a(d){if("isArray" in Array){return Array.isArray(d)}return Object.prototype.toString.call(d)==="[object Array]"}function c(s){var q,k,i,r,m,o,p,n,l;s=typeof s==="object"?s:{};for(q in c.defaults){if(typeof s[q]==="undefined"||s[q===null]){s[q]=c.defaults[q]}}function e(){if(s.debug){var t=Array.prototype.slice.call(arguments);t.unshift("Automator.js: ");console.log.apply(console,t)}}function h(){k=[];i=[];r=0;m=1;o=0;n=new s.Deferred();l=false}function j(u,t){if(typeof t==="number"&&t>0){e("Sleeping for "+t+"ms");return setTimeout.bind(null,u,t)}return u}function g(u,t){if(b(t)){t.always(u)}else{if(a(t)&&t.length>0){i.unshift(t);u()}else{u(t)}}}function f(A){var t,y,w,v,z,u,x;if(l){e("was killed by user, exiting.");return}if(r>=k.length){e("iteration "+o+" completed");if(typeof p==="function"){e("Executing iteration callback");z=p(o)}if(++o>=m){e("Done with iterations");g(n.resolve,z);return}e("Automator iteration "+o+" ready to start");r=0;x=j(f,s.iterationDelay);g(x,z);return}if(i.length>0){y=i[0].shift();if(i[0].length===0){i.shift()}}else{y=k[r++]}if(i.length>0){t=i[0][0]}else{t=k[r]}if(y==null){e("Skipping null action");f();return}e("Handling action: "+y);w=(typeof y);if(w==="number"){v=s.doNumber}else{if(w==="string"){v=s.doString}else{if(w==="function"){v=s.doFunction}else{throw"Unsupported type!"}}}if(w==="number"||typeof t==="number"||t==null){u=0}else{u=s.stepDelay}x=j(f,u);z=v.call(null,y,A);g(x,z)}function d(u){var v=[],z,y,w,x=-1,t=u.length;while(++x<t){z=u[x];if(typeof z==="string"){y=z.match(/(.*)+x(\d+)$/);if(y&&y.length===3){z=y[1];w=parseInt(y[2],10);while(w-->0){v.push(z)}continue}}v.push(z)}return v}this.automate=function(u,v,t){v=(typeof v==="number")?v:1;h();k=d(u);m=v;p=t;f();return n.promise()};this.kill=function(){l=true}}c.keyCodeMap={"0":48,"1":49,"2":50,"3":51,"4":52,"5":53,"6":54,"7":55,"8":56,"9":57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,left:37,up:38,right:39,down:40,enter:13,tab:9,ctrl:17,esc:27,space:32};c.doNumber=function(f,e){var d=new $.Deferred();setTimeout(d.resolve.bind(d,e),f);return d.promise()};c.doFunction=function(d,e){return d.call(null,e)};c.simulateKeyEvent=function(d,f){var e=document.createEventObject?document.createEventObject():document.createEvent("Events");if(typeof e.initEvent==="function"){e.initEvent("keydown",true,true)}e.keyCode=f;e.which=f;if(typeof document.dispatchEvent==="function"){document.dispatchEvent(e)}else{document.fireEvent("onkeydown",e)}};c.doString=function(e,f){var d=c.keyCodeMap[e];if(typeof d!=="number"){return}return c.simulateKeyEvent("keydown",d)};c.doObject=function(d,e){};c.defaults={debug:false,stepDelay:0,iterationDelay:0,Deferred:$.Deferred,doNumber:c.doNumber,doFunction:c.doFunction,doString:c.doString,doObject:c.doObject};return c}));